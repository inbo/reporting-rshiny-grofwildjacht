---
title: "Rapport Dashboard Wilde Zwijnen"
subtitle: "`r paste0(getRegionLevel(input$dash_regionLevel), ': ', toString(input$dash_locaties))`"
author: "`r paste0('Dashboard v', packageVersion('reportingGrofwild'))`"
date: "`r format(Sys.Date(), '%d-%m-%Y')`"
toc-title: "Inhoudsopgave"
output: 
   oaStyle::pdf_report:
      logo: NULL
      bigLogoSize: 15cm
      always_allow_html: yes
      latex_engine: pdflatex 
editor_options: 
  chunk_output_type: console
---

```{r knitr, echo = FALSE, results = 'hide', warning = FALSE}
library(knitr)
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE, 
  message = FALSE,
  fig.align = 'center',
  fig.width = 10, 
  fig.height = 8
)
```


# ACHTERGRONDINFORMATIE

* Regio-schaal: `r getRegionLevel(input$dash_regionLevel)`
* Regio('s): `r toString(input$dash_locaties)`


```{r 'mapFlanders'}
incProgress(amount = 0.1, detail = "Achtergrondinformatie")

tmpFile <- tempfile(fileext = ".html")
htmlwidgets::saveWidget(results$dash_finalMap()$plot, file = tmpFile, selfcontained = FALSE)
webshot::webshot(url = tmpFile, vwidth = 1000, vheight = 500, cliprect = "viewport")
```

## Biotoop beschrijving

```{r 'biotoopPlotText', results = 'asis'}
print(HTML(uiText[uiText$plotFunction == "barBiotoop", "dash"]))
```

```{r 'biotoopPlot'}
plotlyReport(barBiotoop(data = subset(biotoopData[[input$dash_regionLevel]], regio %in% input$dash_locaties))$plot)
```

```{r 'biotoopTableText', results = 'asis'}
print(HTML(uiText[uiText$plotFunction == "tableBackground", "dash"]))
```

```{r 'biotoopTable'}
myTable <- tableBackground(data = rbind(
  subset(biotoopData[[input$dash_regionLevel]], regio %in% input$dash_locaties), 
  biotoopData$flanders))$data
tmpTable <- DT::datatable(myTable, rownames = FALSE,
                          options = list(dom = 't', pageLength = -1))
DT::formatStyle(tmpTable,
                colnames(myTable)[1],
                target = "row",
                fontWeight = DT::styleEqual(tail(myTable[, 1], n = 1), "bold")
)
```


```{r popSection, eval = !is.null(results$dash_showPopulatie()), results = "asis"}
cat("\\newpage")
cat("#", toupper("Populatie"), "\n\n")

incProgress(amount = 0.2, detail = "Populatie")

section <- "Populatie"
childOutput <- lapply(setdiff(results$dash_showPopulatie(), "F18_8"), function(id) 
  knitr::knit_child("plotDashboard.Rmd", quiet = TRUE, envir = environment())
)
cat(unlist(childOutput), sep = '\n')
```


```{r popKencijfer, eval = !is.null(results$dash_showPopulatie()), results = "asis"}
cat("\\newpage")
cat("## Tabel kencijfer\n")

resTable <- results[["dash_F18_8"]]()[["table"]]

resTable[resTable$category == "Totaal aantal gemeentes","municipality"] <- NA
resTable[,1] <- paste(  resTable[,"category"], resTable[,"count"], sep = ": ")
rownames(resTable) <- NULL

cityList <-   na.omit(resTable[,"municipality"])


colorList <- ifelse((cityList %in% results$res()$observed) & (! cityList %in% results$res()$shot),
                    "#ef8a62",
                    ifelse(
                      (cityList %in% results$res()$observed) & ( cityList %in% results$res()$shot), 
                      "transparent", "#67a9cf") )

names(colorList) <- cityList

tb <- DT::datatable(
  resTable[,c(1,3), drop = FALSE],
  colnames = c("", ""),
  rownames = FALSE,
  extensions = 'RowGroup',
  options = list(
    rowGroup = list(dataSrc = 0),
    pageLength = nrow( resTable),
    columnDefs = list(list(visible=FALSE, targets=0)),
    dom = 't',
    striped = FALSE
  ),
  selection = 'none')

if(length(cityList) > 0 & length(input[["dash_F18_8-dataSource_kencijfer"]]) == 2) {
  
    DT::formatStyle(tb,
      columns = 2,
      valueColumns = 2,
      backgroundColor = DT::styleEqual(unique(cityList), colorList)
    )
}else{
  
  tb
}


```

```{r jachtSection, eval = !is.null(results$dash_showJacht()), results = "asis"}
cat("\\newpage")
cat("#", toupper("Jacht"), "\n\n")

incProgress(amount = 0.2, detail = "Jacht")

section <- "Jacht"
childOutput <- lapply(results$dash_showJacht(), function(id) 
  knitr::knit_child("plotDashboard.Rmd", quiet = TRUE, envir = environment())
)
cat(unlist(childOutput), sep = '\n')
```


```{r schadeSection, eval = !is.null(results$dash_showSchade()), results = "asis"}
cat("\\newpage")
cat("#", toupper("Schade"), "\n\n")

incProgress(amount = 0.2, detail = "Schade")

section <- "Schade"
childOutput <- lapply(results$dash_showSchade(), function(id) 
  knitr::knit_child("plotDashboard.Rmd", quiet = TRUE, envir = environment())
)
cat(unlist(childOutput), sep = '\n')
```


```{r maatschappijSection, eval = !is.null(results$dash_showMaatschappij()), results = "asis"}
cat("\\newpage")
cat("#", toupper("Maatschappelijk draagvlak"), "\n\n")

incProgress(amount = 0.2, detail = "Maatschappelijk draagvlak")

section <- "Maatschappij"
childOutput <- lapply(results$dash_showMaatschappij(), function(id) 
  knitr::knit_child("plotDashboard.Rmd", quiet = TRUE, envir = environment())
)
cat(unlist(childOutput), sep = '\n')
```